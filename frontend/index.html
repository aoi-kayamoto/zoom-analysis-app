<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Dashboard â€” é¢è«‡åˆ†æ</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0d0f14;
            --surface: #141720;
            --surface2: #1c2030;
            --border: rgba(255, 255, 255, 0.07);
            --text: #e8eaf0;
            --muted: #6b7280;
            --accent: #4f9cf9;
            --green: #34d399;
            --red: #f87171;
            --amber: #fbbf24;
            --coach: #4f9cf9;
            --student: #a78bfa;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.6;
        }

        body::before {
            content: '';
            position: fixed;
            top: -200px;
            left: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(79, 156, 249, .06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -200px;
            right: -200px;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(167, 139, 250, .05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .wrapper {
            position: relative;
            z-index: 1;
            max-width: 960px;
            margin: 0 auto;
            padding: 48px 24px 80px;
        }

        /* Header */
        .header {
            margin-bottom: 40px;
            animation: fadeUp .5s ease both;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 6px;
        }

        .logo-dot {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1)
            }

            50% {
                opacity: .6;
                transform: scale(1.3)
            }
        }

        .header h1 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: .02em;
            color: #fff;
        }

        .header p {
            color: var(--muted);
            font-size: 13px;
            font-weight: 300;
            padding-left: 20px;
        }

        /* Upload */
        .upload-zone {
            background: var(--surface);
            border: 1px dashed rgba(79, 156, 249, .3);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: border-color .2s, background .2s;
            animation: fadeUp .5s .1s ease both;
        }

        .upload-zone.drag-over {
            border-color: rgba(79, 156, 249, .8);
            background: rgba(79, 156, 249, .05);
        }

        .upload-icon {
            width: 52px;
            height: 52px;
            margin: 0 auto 16px;
            background: rgba(79, 156, 249, .1);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .upload-zone h2 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .upload-zone p {
            color: var(--muted);
            font-size: 12px;
        }

        #fileInput {
            display: none;
        }

        .upload-btn {
            margin-top: 20px;
            display: inline-block;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 28px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: opacity .2s;
        }

        .upload-btn:hover {
            opacity: .85;
        }

        /* Progress */
        .progress-box {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .progress-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .progress-sub {
            color: var(--muted);
            font-size: 12px;
            margin-bottom: 20px;
        }

        .progress-track {
            background: rgba(255, 255, 255, .05);
            border-radius: 4px;
            height: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb, #4f9cf9);
            border-radius: 4px;
            width: 0%;
            transition: width .4s ease;
            animation: shimmer 1.8s infinite linear;
            background-size: 200% 100%;
            background-image: linear-gradient(90deg, #2563eb 0%, #4f9cf9 50%, #2563eb 100%);
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0
            }

            100% {
                background-position: -200% 0
            }
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
        }

        .progress-step {
            font-size: 11px;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .progress-step.active {
            color: var(--accent);
        }

        .progress-step.done {
            color: var(--green);
        }

        /* Error */
        .error-box {
            background: rgba(248, 113, 113, .08);
            border: 1px solid rgba(248, 113, 113, .2);
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 20px;
            color: var(--red);
            font-size: 13px;
        }

        /* Section title */
        .section-title {
            font-size: 11px;
            font-weight: 500;
            letter-spacing: .12em;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
            transition: border-color .2s;
        }

        .card:hover {
            border-color: rgba(255, 255, 255, .12);
        }

        .card-label {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 8px;
            letter-spacing: .04em;
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'DM Mono', monospace;
            color: #fff;
        }

        .card-value.red {
            color: var(--red);
        }

        .card-value.green {
            color: var(--green);
        }

        .card-value.amber {
            color: var(--amber);
        }

        .card-sub {
            font-size: 12px;
            color: var(--muted);
            margin-top: 4px;
        }

        /* Alert badge */
        .alert-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            font-weight: 500;
            padding: 3px 10px;
            border-radius: 20px;
            margin-top: 8px;
        }

        .alert-badge.danger {
            background: rgba(248, 113, 113, .12);
            color: var(--red);
            border: 1px solid rgba(248, 113, 113, .25);
        }

        .alert-badge.warning {
            background: rgba(251, 191, 36, .12);
            color: var(--amber);
            border: 1px solid rgba(251, 191, 36, .25);
        }

        .alert-badge.safe {
            background: rgba(52, 211, 153, .10);
            color: var(--green);
            border: 1px solid rgba(52, 211, 153, .2);
        }

        /* Talk ratio */
        .talk-ratio-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .speaker-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .speaker-name {
            font-size: 12px;
            font-weight: 500;
            width: 60px;
            flex-shrink: 0;
        }

        .speaker-name.coach {
            color: var(--coach);
        }

        .speaker-name.student {
            color: var(--student);
        }

        .bar-track {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, .04);
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 10px;
            font-family: 'DM Mono', monospace;
            font-weight: 500;
            color: rgba(255, 255, 255, .8);
            transition: width 1.2s cubic-bezier(.4, 0, .2, 1);
        }

        .bar-fill.coach {
            background: linear-gradient(90deg, #2563eb, #4f9cf9);
        }

        .bar-fill.student {
            background: linear-gradient(90deg, #7c3aed, #a78bfa);
        }

        .pct-label {
            font-family: 'DM Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            width: 50px;
            text-align: right;
            flex-shrink: 0;
        }

        .pct-label.coach {
            color: var(--coach);
        }

        .pct-label.student {
            color: var(--student);
        }

        .balance-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }

        .balance-chip.good {
            background: rgba(52, 211, 153, .12);
            color: var(--green);
            border: 1px solid rgba(52, 211, 153, .2);
        }

        .balance-chip.warn {
            background: rgba(251, 191, 36, .12);
            color: var(--amber);
            border: 1px solid rgba(251, 191, 36, .25);
        }

        /* Stars */
        .score-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .score-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .score-row:last-child {
            border-bottom: none;
        }

        .score-label {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stars {
            display: flex;
            gap: 3px;
        }

        .star {
            font-size: 16px;
        }

        .star.filled {
            color: var(--amber);
        }

        .star.empty {
            color: rgba(255, 255, 255, .12);
        }

        .score-num {
            font-family: 'DM Mono', monospace;
            font-size: 12px;
            color: var(--muted);
            margin-left: 10px;
            min-width: 30px;
        }

        /* Advice */
        .advice-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .advice-item {
            display: flex;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .advice-item:last-child {
            border-bottom: none;
        }

        .advice-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-top: 7px;
            flex-shrink: 0;
        }

        .advice-dot.red {
            background: var(--red);
            box-shadow: 0 0 6px var(--red);
        }

        .advice-dot.amber {
            background: var(--amber);
        }

        .advice-dot.green {
            background: var(--green);
        }

        .advice-text {
            font-size: 13px;
            line-height: 1.6;
        }

        /* Transcript */
        .transcript-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .transcript-item {
            display: flex;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, .03);
        }

        .ts-time {
            font-family: 'DM Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            width: 44px;
            flex-shrink: 0;
            padding-top: 2px;
        }

        .ts-speaker {
            font-size: 11px;
            font-weight: 600;
            width: 50px;
            flex-shrink: 0;
            padding-top: 2px;
        }

        .ts-speaker.coach {
            color: var(--coach);
        }

        .ts-speaker.student {
            color: var(--student);
        }

        .ts-text {
            font-size: 13px;
            flex: 1;
            line-height: 1.6;
        }

        .ts-text.long-speech {
            background: rgba(248, 113, 113, .06);
            border-left: 2px solid var(--red);
            padding-left: 8px;
            border-radius: 0 4px 4px 0;
        }

        .ts-duration {
            font-family: 'DM Mono', monospace;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            flex-shrink: 0;
            align-self: flex-start;
            margin-top: 3px;
        }

        .ts-duration.long {
            background: rgba(248, 113, 113, .15);
            color: var(--red);
        }

        .ts-duration.normal {
            background: rgba(255, 255, 255, .05);
            color: var(--muted);
        }

        /* Meta */
        .meta-row {
            display: flex;
            gap: 20px;
            margin-bottom: 28px;
            padding: 14px 18px;
            background: var(--surface);
            border-radius: 10px;
            border: 1px solid var(--border);
            font-size: 12px;
            color: var(--muted);
            flex-wrap: wrap;
        }

        .meta-item strong {
            color: var(--text);
            font-weight: 500;
            display: block;
            font-size: 13px;
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(52, 211, 153, .06);
            border: 1px solid rgba(52, 211, 153, .15);
            border-radius: 8px;
            font-size: 12px;
            color: var(--green);
            margin-bottom: 28px;
        }

        .reset-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--muted);
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 12px;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
        }

        .reset-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(16px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .anim-1 {
            animation: fadeUp .5s .1s ease both;
        }

        .anim-2 {
            animation: fadeUp .5s .2s ease both;
        }

        .anim-3 {
            animation: fadeUp .5s .3s ease both;
        }

        .anim-4 {
            animation: fadeUp .5s .4s ease both;
        }

        .anim-5 {
            animation: fadeUp .5s .5s ease both;
        }

        .anim-6 {
            animation: fadeUp .5s .6s ease both;
        }

        @media(max-width:640px) {

            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }

            .card-value {
                font-size: 22px;
            }

            .meta-row {
                gap: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="wrapper">

        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo-dot"></div>
                <h1>Coach Dashboard</h1>
            </div>
            <p>Zoomé¢è«‡ã‚’ç§‘å­¦çš„ã«åˆ†æã—ã€ã‚³ãƒ¼ãƒãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã™</p>
        </div>

        <!-- Upload zone -->
        <div id="uploadSection">
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">ğŸ™ï¸</div>
                <h2>é¢è«‡å‹•ç”»ãƒ»éŸ³å£°ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
                <p>MP4 / MOV / MP3 / WAV Â· ZooméŒ²ç”»å¯¾å¿œ</p>
                <input type="file" id="fileInput" accept=".mp4,.mov,.mp3,.wav,.m4a,.webm">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦åˆ†æé–‹å§‹</button>
            </div>
        </div>

        <!-- Progress -->
        <div id="progressSection" style="display:none">
            <div class="progress-box">
                <div class="progress-title">ğŸ” åˆ†æä¸­...</div>
                <div class="progress-sub" id="progressSub">AIãŒé¢è«‡å†…å®¹ã‚’è§£æã—ã¦ã„ã¾ã™ï¼ˆ60åˆ†å‹•ç”»ã§10ã€œ15åˆ†ã‹ã‹ã‚Šã¾ã™ï¼‰</div>
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-steps">
                    <div class="progress-step" id="step1">ğŸ“‚ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
                    <div class="progress-step" id="step2">ğŸµ éŸ³å£°æŠ½å‡º</div>
                    <div class="progress-step" id="step3">ğŸ“ æ–‡å­—èµ·ã“ã—</div>
                    <div class="progress-step" id="step4">ğŸ“Š åˆ†æ</div>
                </div>
            </div>
        </div>

        <!-- Error -->
        <div id="errorSection" style="display:none">
            <div class="error-box" id="errorMsg"></div>
            <button class="reset-btn" onclick="resetUI()">â† ã‚„ã‚Šç›´ã™</button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" style="display:none">

            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
                <div class="status-bar anim-1" style="margin-bottom:0;flex:1;margin-right:12px">
                    âœ… &nbsp;åˆ†æå®Œäº† â€” <span id="resultFilename"></span>ï¼ˆ<span id="resultDuration"></span>ï¼‰
                </div>
                <button class="reset-btn anim-1" onclick="resetUI()">â† æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«</button>
            </div>

            <div class="meta-row anim-1" id="metaRow"></div>

            <!-- ç™ºè©±å‰²åˆ -->
            <div class="section-title anim-2">ç™ºè©±å‰²åˆ</div>
            <div class="talk-ratio-card anim-2">
                <div class="card-label" style="margin-bottom:16px">è©±è€…ã”ã¨ã®ç™ºè©±æ™‚é–“ãƒãƒ©ãƒ³ã‚¹</div>
                <div class="speaker-row">
                    <div class="speaker-name coach">ã‚³ãƒ¼ãƒ</div>
                    <div class="bar-track">
                        <div class="bar-fill coach" id="coachBar" style="width:0%"></div>
                    </div>
                    <div class="pct-label coach" id="coachPct">â€”</div>
                </div>
                <div class="speaker-row">
                    <div class="speaker-name student">å—è¬›ç”Ÿ</div>
                    <div class="bar-track">
                        <div class="bar-fill student" id="studentBar" style="width:0%"></div>
                    </div>
                    <div class="pct-label student" id="studentPct">â€”</div>
                </div>
                <div style="margin-top:14px;font-size:12px;color:var(--muted);display:flex;align-items:center;gap:6px">
                    ãƒãƒ©ãƒ³ã‚¹è©•ä¾¡ï¼š<span class="balance-chip" id="balanceChip"></span>
                </div>
            </div>

            <!-- Stats -->
            <div class="section-title anim-3">é¢è«‡ã‚µãƒãƒªãƒ¼</div>
            <div class="grid-3 anim-3">
                <div class="card">
                    <div class="card-label">æœ€é•·é€£ç¶šç™ºè©±</div>
                    <div class="card-value" id="longestVal">â€”</div>
                    <div id="longestBadge"></div>
                </div>
                <div class="card">
                    <div class="card-label">ç™ºè©±å›æ•°ï¼ˆã‚³ãƒ¼ãƒï¼‰</div>
                    <div class="card-value" id="coachTurns">â€”</div>
                    <div class="card-sub" id="studentTurnsSub">â€”</div>
                </div>
                <div class="card">
                    <div class="card-label">æ²ˆé»™ãƒ»é–“ï¼ˆ3ç§’ä»¥ä¸Šï¼‰</div>
                    <div class="card-value amber" id="silenceCount">â€”</div>
                    <div class="card-sub" id="silenceAvg">â€”</div>
                </div>
            </div>
            <div class="grid-2 anim-3">
                <div class="card">
                    <div class="card-label">ã‚³ãƒ¼ãƒå¹³å‡ç™ºè©±æ™‚é–“</div>
                    <div class="card-value" id="avgCoach">â€”</div>
                    <div class="card-sub">ç†æƒ³ç›®å®‰ï¼š15ç§’ä»¥ä¸‹</div>
                </div>
                <div class="card">
                    <div class="card-label">è³ªå•æ•°ï¼ˆã‚³ãƒ¼ãƒï¼‰</div>
                    <div class="card-value green" id="qCount">â€”</div>
                    <div class="card-sub" id="qDetail">â€”</div>
                </div>
            </div>

            <!-- Skill scores -->
            <div class="section-title anim-4">ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢</div>
            <div class="score-section anim-4">
                <div class="score-row">
                    <div class="score-label">ğŸ¤ å…±æ„Ÿã‚¹ã‚³ã‚¢</div>
                    <div style="display:flex;align-items:center">
                        <div class="stars" id="s-empathy"></div>
                        <div class="score-num" id="n-empathy"></div>
                    </div>
                </div>
                <div class="score-row">
                    <div class="score-label">âœ… æ‰¿èªã‚¹ã‚³ã‚¢</div>
                    <div style="display:flex;align-items:center">
                        <div class="stars" id="s-approval"></div>
                        <div class="score-num" id="n-approval"></div>
                    </div>
                </div>
                <div class="score-row">
                    <div class="score-label">â“ å•ã„ã‚¹ã‚³ã‚¢</div>
                    <div style="display:flex;align-items:center">
                        <div class="stars" id="s-question"></div>
                        <div class="score-num" id="n-question"></div>
                    </div>
                </div>
                <div class="score-row">
                    <div class="score-label">ğŸ”‡ æ²ˆé»™ã®æ´»ç”¨</div>
                    <div style="display:flex;align-items:center">
                        <div class="stars" id="s-silence"></div>
                        <div class="score-num" id="n-silence"></div>
                    </div>
                </div>
                <div class="score-row">
                    <div class="score-label">ğŸ‘‚ å‚¾è´ã‚¹ã‚³ã‚¢</div>
                    <div style="display:flex;align-items:center">
                        <div class="stars" id="s-listening"></div>
                        <div class="score-num" id="n-listening"></div>
                    </div>
                </div>
            </div>

            <!-- Advice -->
            <div class="section-title anim-5">æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
            <div class="advice-card anim-5" id="adviceCard"></div>

            <!-- Transcript -->
            <div class="section-title anim-6">ç™ºè©±ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
            <div class="transcript-card anim-6" id="transcriptCard"></div>

        </div><!-- /#dashboard -->
    </div>

    <script>
        const API = '';  // åŒã˜ã‚ªãƒªã‚¸ãƒ³ãªã®ã§ç©ºã§ OKï¼ˆåˆ¥ãƒãƒ¼ãƒˆãªã‚‰ 'http://localhost:8000'ï¼‰

        // â”€â”€â”€ UI çŠ¶æ…‹ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function resetUI() {
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }
        function showProgress(sub) {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('progressSub').textContent = sub;
        }
        function showError(msg) {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('errorMsg').textContent = 'âŒ ' + msg;
        }
        function showDashboard() {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        // â”€â”€â”€ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¢ãƒ‹ãƒ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let progressTimer = null;
        function startProgress() {
            const fill = document.getElementById('progressFill');
            const steps = ['step1', 'step2', 'step3', 'step4'];
            let pct = 0, step = 0;
            steps.forEach(id => document.getElementById(id).className = 'progress-step');

            progressTimer = setInterval(() => {
                if (pct < 15) { pct += 3; step = 0; }
                else if (pct < 35) { pct += 1; step = 1; }
                else if (pct < 90) { pct += 0.3; step = 2; }
                else { pct = Math.min(pct + 0.1, 95); step = 3; }
                fill.style.width = pct + '%';
                steps.forEach((id, i) => {
                    const el = document.getElementById(id);
                    el.className = 'progress-step' + (i < step ? ' done' : i === step ? ' active' : '');
                });
            }, 400);
        }
        function stopProgress() {
            clearInterval(progressTimer);
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('step4').className = 'progress-step done';
        }

        // â”€â”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ â†’ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.getElementById('fileInput').addEventListener('change', e => {
            const file = e.target.files[0];
            if (file) uploadAndAnalyze(file);
        });

        // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
        const zone = document.getElementById('uploadZone');
        zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
        zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
        zone.addEventListener('drop', e => {
            e.preventDefault();
            zone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) uploadAndAnalyze(file);
        });

        async function uploadAndAnalyze(file) {
            showProgress(`${file.name} ã‚’åˆ†æä¸­... 60åˆ†å‹•ç”»ã§10ã€œ15åˆ†ã‹ã‹ã‚Šã¾ã™`);
            startProgress();

            const form = new FormData();
            form.append('file', file);

            try {
                const res = await fetch(API + '/analyze', { method: 'POST', body: form });
                stopProgress();

                if (!res.ok) {
                    const err = await res.json().catch(() => ({ detail: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼' }));
                    showError(err.detail || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                    return;
                }
                const data = await res.json();
                renderDashboard(data);
                showDashboard();

            } catch (err) {
                stopProgress();
                showError('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚uvicorn ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // â”€â”€â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderDashboard(d) {
            const s = d.stats;
            const sc = d.scores;

            // ãƒ¡ã‚¿
            document.getElementById('resultFilename').textContent = d.filename;
            document.getElementById('resultDuration').textContent = d.duration;
            document.getElementById('metaRow').innerHTML = `
    <div class="meta-item"><strong>${d.filename}</strong>ãƒ•ã‚¡ã‚¤ãƒ«å</div>
    <div class="meta-item"><strong>${d.duration}</strong>é¢è«‡æ™‚é–“</div>
    <div class="meta-item"><strong>${s.coach_turns}å› / ${s.student_turns}å›</strong>ç™ºè©±å›æ•° (ã‚³ãƒ¼ãƒ/å—è¬›ç”Ÿ)</div>
  `;

            // ãƒãƒ¼
            setTimeout(() => {
                const cb = document.getElementById('coachBar');
                cb.style.width = s.coach_pct + '%';
                cb.textContent = s.coach_pct + '%';
                document.getElementById('coachPct').textContent = s.coach_pct + '%';

                const sb = document.getElementById('studentBar');
                sb.style.width = s.student_pct + '%';
                sb.textContent = s.student_pct + '%';
                document.getElementById('studentPct').textContent = s.student_pct + '%';
            }, 200);

            const chip = document.getElementById('balanceChip');
            if (s.student_pct >= 55) {
                chip.className = 'balance-chip good';
                chip.textContent = 'âœ… ãƒãƒ©ãƒ³ã‚¹è‰¯å¥½';
            } else {
                chip.className = 'balance-chip warn';
                chip.textContent = 'âš  ã‚³ãƒ¼ãƒã®ç™ºè©±ãŒã‚„ã‚„å¤šã‚';
            }

            // æœ€é•·ç™ºè©±
            const lv = document.getElementById('longestVal');
            lv.textContent = s.longest_speech + 'ç§’';
            lv.className = 'card-value ' + (s.longest_speech_alert === 'danger' ? 'red' : s.longest_speech_alert === 'warning' ? 'amber' : '');
            const badge = { danger: '<div class="alert-badge danger">ğŸš¨ è©±ã—ã™ãï¼ˆ60ç§’è¶…ï¼‰</div>', warning: '<div class="alert-badge warning">ğŸ”´ è¦æ³¨æ„ï¼ˆ30ç§’è¶…ï¼‰</div>', safe: '<div class="alert-badge safe">âœ… å•é¡Œãªã—</div>' };
            document.getElementById('longestBadge').innerHTML = badge[s.longest_speech_alert];

            // ãã®ä»–stats
            document.getElementById('coachTurns').textContent = s.coach_turns + 'å›';
            document.getElementById('studentTurnsSub').textContent = `å—è¬›ç”Ÿï¼š${s.student_turns}å›`;
            document.getElementById('silenceCount').textContent = s.silence_count + 'å›';
            document.getElementById('silenceAvg').textContent = s.silence_count > 0 ? `å¹³å‡ ${s.silence_avg}ç§’` : 'æ²ˆé»™ãªã—';
            const avgEl = document.getElementById('avgCoach');
            avgEl.textContent = s.avg_coach_duration + 'ç§’';
            avgEl.className = 'card-value ' + (s.avg_coach_duration > 20 ? 'amber' : 'green');
            document.getElementById('qCount').textContent = s.question_count + 'å•';
            document.getElementById('qDetail').textContent = `ã‚ªãƒ¼ãƒ—ãƒ³:${s.open_questions} / ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰:${s.closed_questions}`;

            // Stars
            const scoreMap = { empathy: sc.empathy, approval: sc.approval, question: sc.question, silence: sc.silence, listening: sc.listening };
            for (const [key, val] of Object.entries(scoreMap)) {
                document.getElementById('s-' + key).innerHTML = [1, 2, 3, 4, 5].map(i => `<span class="star ${i <= val ? 'filled' : 'empty'}">â˜…</span>`).join('');
                document.getElementById('n-' + key).textContent = val + '/5';
            }

            // Advice
            const adviceCard = document.getElementById('adviceCard');
            adviceCard.innerHTML = d.advice.map(a => `
    <div class="advice-item">
      <div class="advice-dot ${a.level}"></div>
      <div class="advice-text">${a.text}</div>
    </div>
  `).join('');

            // Transcript
            const tc = document.getElementById('transcriptCard');
            tc.innerHTML = d.segments.map(seg => {
                const isLong = seg.duration >= 30;
                const mm = Math.floor(seg.start / 60).toString().padStart(2, '0');
                const ss = Math.floor(seg.start % 60).toString().padStart(2, '0');
                return `
      <div class="transcript-item">
        <div class="ts-time">${mm}:${ss}</div>
        <div class="ts-speaker ${seg.speaker}">${seg.speaker === 'coach' ? 'ã‚³ãƒ¼ãƒ' : 'å—è¬›ç”Ÿ'}</div>
        <div class="ts-text ${isLong ? 'long-speech' : ''}">${escapeHtml(seg.text)}</div>
        <div class="ts-duration ${isLong ? 'long' : 'normal'}">${isLong ? 'ğŸ”´ ' : ''}${seg.duration}s</div>
      </div>
    `;
            }).join('');
        }

        function escapeHtml(s) {
            return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
    </script>
</body>

</html>